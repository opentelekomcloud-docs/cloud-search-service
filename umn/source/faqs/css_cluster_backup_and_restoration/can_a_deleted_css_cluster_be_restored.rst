:original_name: css_02_0120.html

.. _css_02_0120:

Can a Deleted CSS Cluster Be Restored?
======================================

Yes. You can use a snapshot stored in OBS to restore a cluster. A deleted cluster that has no snapshots in OBS cannot be restored. Exercise caution when deleting a cluster.

To restore a deleted cluster using one of its snapshots stored in OBS, perform the following steps:

#. Log in to the CSS management console.

#. Click **Create Cluster** in the upper right corner to create a cluster. During the cluster creation, disable the cluster snapshot function. After the cluster is created, enable the cluster snapshot function.

   .. important::

      To restore a deleted cluster to a new cluster, ensure they are in the same region. The new cluster version must be the same as or later than that of the deleted cluster. The quantity of nodes in the new cluster must be greater than half of that in the deleted cluster. Otherwise, the cluster may fail to be restored.

#. If the status of the new cluster changes to **Available**, click the cluster name to go to the **Cluster Information** page.

#. In the navigation pane on the left, choose **Cluster Snapshots**. Enable the cluster snapshot function. Set the OBS bucket and backup path to those set for the cluster that needs to be restored.

   After the configuration is saved, you can view the snapshot information of the deleted cluster in the snapshot management list **a few minutes later**. **If the snapshot is not displayed, edit the basic snapshot configuration again, change the backup path to another one and then to the correct one, save the modification, and try again.**

   .. note::

      To restore the data of a deleted cluster to an existing cluster, set the OBS bucket and backup path to those of the deleted cluster.

#. Locate the target snapshot and click **Restore** in the **Operation** column. The **Restore** page is displayed.

#. On the **Restore** page, set restoration parameters.

   .. table:: **Table 1** Restoration settings

      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Parameter                         | Description                                                                                                                                                                                                                                                                                                                                                                                |
      +===================================+============================================================================================================================================================================================================================================================================================================================================================================================+
      | Index                             | Specify the name of the index you want to restore.                                                                                                                                                                                                                                                                                                                                         |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                            |
      |                                   | Constraints:                                                                                                                                                                                                                                                                                                                                                                               |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                            |
      |                                   | -  The value is a string of 0 to 1024 characters that cannot contain uppercase letters, spaces, or the following special characters: **"\\<|>/?**.                                                                                                                                                                                                                                         |
      |                                   | -  When restoring an index whose name is prefixed with **.kibana**, the index name must be specified.                                                                                                                                                                                                                                                                                      |
      |                                   | -  The **.opendistro_security** index cannot be restored.                                                                                                                                                                                                                                                                                                                                  |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                            |
      |                                   | Value range:                                                                                                                                                                                                                                                                                                                                                                               |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                            |
      |                                   | -  You can use an asterisk (*) to match multiple indexes. For example, **index\*** indicates that all indexes with the prefix **index** will be restored. When an asterisk (*) is used for index matching, the **.opendistro_security** index and any system indexes whose name is prefixed with **.kibana** are filtered out by default.                                                  |
      |                                   | -  You can restore indexes by specifying their names, for example, **index1,index2,index3**.                                                                                                                                                                                                                                                                                               |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                            |
      |                                   | Default value:                                                                                                                                                                                                                                                                                                                                                                             |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                            |
      |                                   | By default, this parameter is left blank. That is, no index name is specified, and all indexes will be restored.                                                                                                                                                                                                                                                                           |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Rename Pattern                    | Index name matching rule. Enter a regular expression. Indexes that match the regular expression will be restored. The default value **index_(.+)** indicates all indexes. The value is a string of 0 to 1024 characters that cannot contain uppercase letters, spaces, or the following special characters: **"\\<|>/?,**.                                                                 |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                            |
      |                                   | .. note::                                                                                                                                                                                                                                                                                                                                                                                  |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                            |
      |                                   |    The **Rename Pattern** and **Rename Replacement** take effect only when they are both configured at the same time.                                                                                                                                                                                                                                                                      |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Rename Replacement                | Rule for index renaming. The default value **restored_index_$1** indicates that **restored\_** will be added to the beginning of the names of all restored indexes. The value is a string of 0 to 1024 characters that cannot contain uppercase letters, spaces, or the following special characters: **"\\<|>/?,**.                                                                       |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                            |
      |                                   | .. note::                                                                                                                                                                                                                                                                                                                                                                                  |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                            |
      |                                   |    The **Rename Pattern** and **Rename Replacement** take effect only when they are both configured at the same time.                                                                                                                                                                                                                                                                      |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Cluster                           | Select the cluster where you want to restore the data to. You can select the current cluster or another.                                                                                                                                                                                                                                                                                   |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                            |
      |                                   | -  You must specify a cluster whose status is **Available**. If the status of the current cluster is **Unavailable**, you cannot restore the snapshot to the current cluster.                                                                                                                                                                                                              |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                            |
      |                                   | -  When you choose to restore data to another cluster, make sure the target cluster has the same or later version than the current cluster, and that the two clusters are in the same region. After a frozen index is restored using a snapshot, the index is stored on the local node and is read-only by default. To make it writable, run the following command to configure the index: |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                            |
      |                                   |    .. code:: text                                                                                                                                                                                                                                                                                                                                                                          |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                            |
      |                                   |       PUT index_name/_settings                                                                                                                                                                                                                                                                                                                                                             |
      |                                   |       {                                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   |         "index.blocks.write": null                                                                                                                                                                                                                                                                                                                                                         |
      |                                   |       }                                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                            |
      |                                   | -  If the destination cluster has same-name indexes as the source cluster, data in these indexes will be overwritten. Exercise caution when performing this operation.                                                                                                                                                                                                                     |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+


   .. figure:: /_static/images/en-us_image_0000001933159230.png
      :alt: **Figure 1** Restore Snapshot

      **Figure 1** Restore Snapshot

#. Click **OK** to get started. If restoration succeeds, **Task Status** of the snapshot in the snapshot list will change to **Restoration succeeded**, and the index data is re-generated based on the snapshot.


   .. figure:: /_static/images/en-us_image_0000001933159234.png
      :alt: **Figure 2** Restoration succeeded

      **Figure 2** Restoration succeeded
