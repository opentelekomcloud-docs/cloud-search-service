:original_name: css_01_0082.html

.. _css_01_0082:

VPC Endpoint Service
====================

The VPC endpoint service allows you to access the cluster through a private domain name. When the VPC endpoint service is enabled, the system creates a VPC endpoint for you by default. To create a VPC endpoint, you must have the required permissions. For details, see .

.. caution::

   The public IP address access and VPC endpoint service share a load balancer. If you have configured a public access whitelist, public and private IP addresses that access the cluster through VPCEP are restricted because the public IP address access shares the load balancer with the VPC endpoint service. In this case, you need to add IP address **198.19.128.0/17** to the public access whitelist to allow traffic through VPCEP.

Enabling the VPC Endpoint Service
---------------------------------

#. Log in to the CSS management console.
#. On the **Create Cluster** page, set **Advanced Settings** to **Custom**. Enable the VPC endpoint service.

   -  **Private Domain Name Creation**: If you enable this function, the system automatically creates a private domain name for you, which you can use to access the cluster.

   -  **VPC Endpoint Service Whitelist**: You can add an authorized account ID to the VPC endpoint service whitelist. Then you can access the cluster using the domain name or the node IP address.

      Click |image1| to add multiple accounts. You can also click **Delete** in the **Operation** column to delete accounts.

   .. note::

      -  If the authorization account ID is set to **\***, all users are allowed to access the cluster.
      -  You can view authorized account IDs on the **My Credentials** page.
      -  After the VPC endpoint service is enabled for a cluster, you will be billed per use. For more information, see .

Managing VPC Endpoint Service
-----------------------------

You can enable the VPC endpoint service while creating a cluster, and also enable it by performing the following steps after cluster creation.

#. Log in to the CSS management console.

#. On the **Clusters** page, click the name of the target cluster.

#. Click the **VPC Endpoint Service** tab, and turn on the button next to **VPC Endpoint Service**.

   |image2| indicates disabling the VPC endpoint service and |image3| indicates enabling the VPC endpoint service.

   In the displayed dialog box, you can determine whether to enable the private domain name. After a private domain name is created, you can access the cluster using the private domain name.

   .. note::

      -  After you enable the VPC endpoint service, you can use the private domain name or node IP address generated by the endpoint to access the cluster. For details, see :ref:`Accessing the Cluster Using the Private Domain Name or Node IP Address <css_01_0082__section19864153679>`.
      -  If you disable the VPC endpoint service, none of the users can access the cluster using the private domain name.

#. Click **Yes** to enable the VPC endpoint service.

#. (Optional) Click **Update** next to **VPC Endpoint Service Whitelist** to update the existing whitelist.

#. Manage connections of the VPC endpoint.

   The **VPC Endpoint Service** page displays all VPC endpoints connected to the current VPC endpoint service. You can accept or reject the connection with these endpoints. If you reject the connection with a VPC endpoint, you cannot access the cluster through the private domain name generated by the VPC endpoint.

.. _css_01_0082__section19864153679:

Accessing the Cluster Using the Private Domain Name or Node IP Address
----------------------------------------------------------------------

#. Obtain the private domain name or node IP address.

   -  Current user

      Log in to the CSS console, click the target cluster name and go to the **Basic Information** page. Click the **VPC Endpoint Service** tab and view the private domain name.

   -  Other users

      If you have applied for the VPC endpoint service, log in to the and click the target ID to go to the **Summary** page and view the private domain name.

#. Run the cURL command to execute the API or call the API by using a program before accessing the cluster. For details about Elasticsearch operations and APIs, see the `Elasticsearch Reference <https://www.elastic.co/guide/en/elasticsearch/guide/current/index.html>`__.

   The ECS must meet the following requirements:

   -  Sufficient disk space is allocated for the ECS.

   -  The ECS and the cluster must be in the same VPC. After enabling the VPC endpoint service, you can access the cluster from the ECS even when the cluster is not in the same VPC as the ECS.

   -  The security group of the ECS must be the same as that of the cluster.

      If this requirement is not met, modify the ECS security group or configure the inbound and outbound rules of the ECS security group to allow the ECS security group to be accessed by all security groups of the cluster. For details, see `Configuring Security Group Rules <https://docs.otc.t-systems.com/en-us/usermanual/ecs/en-us_topic_0030878383.html>`__.

   -  Configure security group rule settings of the target CSS cluster. Set **Protocol** to **TCP** and **Port Range** to **9200** or a port range including port **9200** for both the outbound and inbound directions.

   -  If the cluster does not have the security mode enabled, run the following command:

      .. code-block::

   -  If the cluster you access has the security mode enabled, access the cluster using HTTPS and add the username, password and **-u** to the cURL command.

      .. code-block::

.. |image1| image:: /_static/images/en-us_image_0000001286276706.png
.. |image2| image:: /_static/images/en-us_image_0000001338955989.png
.. |image3| image:: /_static/images/en-us_image_0000001338836529.png
