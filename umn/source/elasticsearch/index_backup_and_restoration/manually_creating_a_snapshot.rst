:original_name: css_01_0268.html

.. _css_01_0268:

Manually Creating a Snapshot
============================

You can manually create a snapshot at any time to back up all data or data of specified indexes.

Prerequisites
-------------

To use the function of creating or restoring snapshots, the account or IAM user logging in to the CSS management console must have both of the following permissions:

-  **Tenant Administrator** for project **OBS** in region **Global service**
-  **CSS Administrator** in the current region

Precautions
-----------

-  When creating a backup for the first time, you are advised to back up data of all indexes.
-  Cluster snapshots will increase the CPU usage and disk I/O. You are advised to take cluster snapshots during off-peak hours.
-  Before creating a snapshot, you need to perform basic configurations, including configuring the OBS bucket for storing snapshots and IAM agency used for security authentication.
-  If there are available snapshots in the snapshot list when you configure the OBS bucket for storing cluster snapshots for the first time, you cannot change the bucket for snapshots that are subsequently created automatically or manually. Exercise caution when you configure the OBS bucket.
-  If snapshots have been stored in the OBS bucket, the OBS bucket cannot be changed. You can disable the snapshot function, enable the snapshot function, and specify a new OBS bucket. After you disable the snapshot function, you cannot use previously created snapshots to restore the cluster.
-  If a cluster is in the **Unavailable** status, you can use the cluster snapshot function only to restore clusters and view existing snapshot information.
-  During backup and restoration of a cluster, you can perform only certain operations, including scaling out, accessing Kibana, viewing metric, and deleting other snapshots of clusters. However, you cannot perform the following operations: restarting or deleting the cluster, deleting a snapshot that is in the **Creating** or **Restoring** status, and creating or restoring another snapshot. If a snapshot is being created or restored for a cluster, any automatic snapshot creation task initiated for the cluster will be canceled.
-  The first snapshot of a cluster is a full snapshot, and subsequent snapshots are incremental snapshots. CSS snapshot files depend on each other.


Manually Creating a Snapshot
----------------------------

#. In the CSS navigation pane on the left, click **Clusters**.

#. On the **Clusters** page that is displayed, click the name of the target cluster. In the navigation pane on the left, choose **Cluster Snapshots**.

#. On the displayed **Cluster Snapshots** page, click the icon to the right of **Cluster Snapshot** to enable the cluster snapshot function.

#. Enable the cluster snapshot function. OBS buckets and IAM agencies are automatically created by CSS to store snapshots. The automatically created OBS bucket and IAM agency are displayed on the page. You can also click |image1| on the right of **Basic Configuration** to edit the configuration. To ensure the security of snapshot data, you can select a key to encrypt the snapshot.

   .. table:: **Table 1** Cluster snapshot parameter

      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Parameter                         | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
      +===================================+================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+
      | OBS Bucket                        | Select an OBS bucket for storing snapshots from the drop-down list box. You can also click **Create Bucket** on the right to create an OBS bucket. For details, see `Creating a Bucket <https://docs.otc.t-systems.com/en-us/usermanual/obs/en-us_topic_0045853662.html>`__.                                                                                                                                                                                                                                                                                                                                                   |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
      |                                   | The created or existing OBS bucket must meet the following requirements:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
      |                                   | -  **Storage Class** is **Standard** or **Warm**.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | IAM Agency                        | IAM agency authorized by the current account for CSS to access or maintain data stored in OBS You can also click **Create IAM Agency** on the right to create an IAM agency. For details, see `Creating an Agency <https://docs.otc.t-systems.com/en-us/usermanual/iam/en-us_topic_0046613147.html>`__.                                                                                                                                                                                                                                                                                                                        |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
      |                                   | The created or existing IAM agency must meet the following requirements:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
      |                                   | -  **Agency Type** must be **Cloud service**.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
      |                                   | -  Set **Cloud Service** to **CSS**.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
      |                                   | -  The agency must have the **Tenant Administrator** permission for the **OBS(S3)** project in **OBS(S3)**.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Snapshot Encryption               | Indicates whether to enable the snapshot encryption function. Enabling the snapshot encryption function ensures the security of your snapshot data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
      |                                   | After the snapshot encryption function is enabled, select a key from the **Key Name** drop-down list. If no key is available, click **Create/View Key** to switch to the KMS management console to create or modify a key. For details, see `Creating a CMK <https://docs.otc.t-systems.com/key-management-service/umn/user_guide/key_management/creating_a_key.html>`__.                                                                                                                                                                                                                                                      |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
      |                                   | -  You cannot use default master keys whose aliases end with **/default** in KMS to encrypt snapshots.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
      |                                   | -  If a snapshot has been stored in the OBS bucket, you cannot modify the parameters used for encrypting the snapshot.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
      |                                   | -  If the key used for encryption is in the **Pending deletion** or **disable** status, you cannot perform backup and restoration operations on the cluster. Specifically, you cannot create new snapshots for the cluster, or use existing snapshots to restore clusters. In this case, switch to the KMS management console and change the status of the target key to **enable** so that backup and restore operations are allowed on the cluster.                                                                                                                                                                          |
      |                                   | -  If you delete the key used for encryption, you cannot perform backup and restore operations on the cluster. In addition, you cannot restore the deleted key. Therefore, exercise caution when deleting a key. If the key is deleted or is in the **Pending deletion** or **disable** state, automatic snapshot creation is allowed based on the configured snapshot policy. However, all automatic snapshot creation tasks will fail, and the failed tasks are displayed in the failed task list in the **Failed Tasks** dialog box. In such scenario, you are advised to disable the automatic snapshot creation function. |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+


   .. figure:: /_static/images/en-us_image_0000001667002358.png
      :alt: **Figure 1** Edit Basic configuration

      **Figure 1** Edit Basic configuration

#. After basic configurations are completed, click **Create**.

   -  **Name** indicates the name of the manually created snapshot, which can contain 4 to 64 characters and must start with a lowercase letter. Only lowercase letters, digits, hyphens (-), and underscores (_) are allowed. For snapshots you create manually, you can specify the snapshot name. The system will not automatically add the time information to the snapshot name.

   -  **Index**: Enter an index name. You can select an index for backup. Use commas (,) to separate multiple indexes. Uppercase letters, spaces, and the following special characters are not allowed: "\\<|>/? If you do not specify this parameter, data of all indexes in the cluster is backed up by default. You can use the asterisk (**\***) to back up data of certain indexes. For example, if you enter **index\***, then data of indexes with the name prefix of **index** will be backed up.

      Run the **GET /_cat/indices** command in Kibana to query the names of all indexes in the cluster.l

   -  **Description**: indicates the description of the created snapshot. The value contains 0 to 256 characters, and certain special characters (**<>**) are not allowed.


   .. figure:: /_static/images/en-us_image_0000001714922221.png
      :alt: **Figure 2** Create snapshot

      **Figure 2** Create snapshot

#. Click **OK**.

   After the snapshot is created, it will be displayed in the snapshot list. The status **Available** indicates that the snapshot is created successfully. along with manually created snapshots. You can distinguish them by the **Snapshot Type** setting. In the upper right corner of the snapshot list, enter the keyword of the snapshot name or snapshot ID to search for the desired snapshots.

.. |image1| image:: /_static/images/en-us_image_0000001714802137.png
