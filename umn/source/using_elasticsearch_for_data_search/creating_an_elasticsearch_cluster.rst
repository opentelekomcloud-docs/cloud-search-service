:original_name: css_01_0380.html

.. _css_01_0380:

Creating an Elasticsearch Cluster
=================================

This topic describes how to create an Elasticsearch cluster.

Scenarios
---------

:ref:`Table 1 <css_01_0380__table143555312413>` lists key parameters that differentiate between different types of clusters.

.. _css_01_0380__table143555312413:

.. table:: **Table 1** Parameters that differentiate between different types of clusters

   +----------------------------------+---------------+--------------+-------------------+----------------------+
   | Cluster Type                     | Security Mode | HTTPS Access | Internet Access   | Kibana Public Access |
   +==================================+===============+==============+===================+======================+
   | Cluster in non-security mode     | Disabled      | N/A          | Cannot be enabled | Cannot be enabled    |
   +----------------------------------+---------------+--------------+-------------------+----------------------+
   | Cluster in security mode + HTTP  | Enabled       | Disabled     | Cannot be enabled | Can be enabled       |
   +----------------------------------+---------------+--------------+-------------------+----------------------+
   | Cluster in security mode + HTTPS | Enabled       | Enabled      | Can be enabled    | Can be enabled       |
   +----------------------------------+---------------+--------------+-------------------+----------------------+

Prerequisites
-------------

You have planned the Elasticsearch clusters that need to be created by following the instructions in :ref:`Elasticsearch Cluster Planning Suggestions <css_01_0379>`.

Creating a Cluster
------------------

#. Log in to the CSS management console.

#. On the **Dashboard** page, click **Create Cluster** in the upper right corner. The **Create Cluster** page is displayed.

   Alternatively, choose **Clusters** > **Elasticsearch** in the navigation tree on the left. Click **Create Cluster** in the upper right corner. The **Create Cluster** page is displayed.

#. On the **Basic Configuration** page, configure basic information and resources for the Elasticsearch cluster.

   .. table:: **Table 2** Basic configuration of the Elasticsearch cluster

      +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Parameter                         | Description                                                                                                                                                                                                                                                                                                                                                                                                                   |
      +===================================+===============================================================================================================================================================================================================================================================================================================================================================================================================================+
      | Region                            | Select the region where the cluster is located.                                                                                                                                                                                                                                                                                                                                                                               |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                               |
      |                                   | ECSs in different regions cannot communicate with each other over an intranet. For lower network latency and quicker resource access, select the nearest region.                                                                                                                                                                                                                                                              |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                               |
      |                                   | Currently, only **eu-de** and **eu-nl** are supported.                                                                                                                                                                                                                                                                                                                                                                        |
      +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | AZ                                | Select AZs associated with the cluster region.                                                                                                                                                                                                                                                                                                                                                                                |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                               |
      |                                   | A maximum of three AZs can be configured. For details about the use of multiple AZs, see :ref:`Planning Cluster AZs <css_01_0379__section1074611275359>`.                                                                                                                                                                                                                                                                     |
      +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Type                              | Select **Elasticsearch**.                                                                                                                                                                                                                                                                                                                                                                                                     |
      +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Version                           | Select a cluster version from the drop-down list box.                                                                                                                                                                                                                                                                                                                                                                         |
      +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Name                              | Cluster name, which contains 4 to 32 characters. Only letters, numbers, hyphens (-), and underscores (_) are allowed and the value must start with a letter.                                                                                                                                                                                                                                                                  |
      +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Nodes                             | Number of nodes in the cluster. Select a number from 1 to 32. You are advised to configure three or more nodes to ensure high availability of the cluster.                                                                                                                                                                                                                                                                    |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                               |
      |                                   | -  If **Master node** and **Client node** are both unselected, data nodes will be used for all of the following purposes: cluster management, data storage, cluster access, and data analysis. To ensure reliability, a cluster should have a least three nodes.                                                                                                                                                              |
      |                                   | -  If **Master node** is selected but **Client node** is not, data nodes will be used for data storage, cluster access, and data analysis.                                                                                                                                                                                                                                                                                    |
      |                                   | -  If **Master node** is unselected but **Client node** is selected, data nodes will be used for data storage and cluster management.                                                                                                                                                                                                                                                                                         |
      |                                   | -  If **Master node** and **Client node** are both selected, data nodes will be used for data storage only.                                                                                                                                                                                                                                                                                                                   |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                               |
      |                                   | .. note::                                                                                                                                                                                                                                                                                                                                                                                                                     |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                               |
      |                                   |    If the number of data nodes in a cluster is not an integer multiple of that of AZs, data in the cluster may be unevenly distributed, affecting data query or write performance.                                                                                                                                                                                                                                            |
      +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | CPU Architecture                  | **x86**. The supported types depend on the actual regional environment.                                                                                                                                                                                                                                                                                                                                                       |
      +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Node Specifications               | Data node flavor. You can select a node flavor based on your needs. Each cluster supports only one node flavor.                                                                                                                                                                                                                                                                                                               |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                               |
      |                                   | After you select a flavor, the CPU and memory corresponding to the current flavor are displayed below. For example, if you select **css.medium.8**, then **1 vCPUs \| 8 GB** will be displayed, indicating that the node flavor you select contains one vCPU and 8 GB memory.                                                                                                                                                 |
      +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Node Storage Type                 | If you select EVS for node storage, you need to further select the EVS disk type for data nodes of the cluster. Options include Common I/O, High I/O, Ultra-high I/O.                                                                                                                                                                                                                                                         |
      +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Node Storage Capacity             | Data node storage capacity. Its value range varies with node specifications.                                                                                                                                                                                                                                                                                                                                                  |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                               |
      |                                   | The node storage capacity must be a multiple of 20.                                                                                                                                                                                                                                                                                                                                                                           |
      +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Master node                       | The master node is responsible for cluster management, such as metadata management, index creation and deletion, and shard allocation. It plays a critical role in metadata management, node management, stability guarantee, and cluster operation control for large-scale clusters.                                                                                                                                         |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                               |
      |                                   | After enabling the master node, specify **Node Specifications**, **Nodes**, and **Node Storage Type**. The value of **Nodes** must be an odd number greater than or equal to 3. Up to nine nodes are supported. The value of **Node Storage Capacity** is fixed. You can select a storage type based on your needs.                                                                                                           |
      +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Client node                       | Client nodes receive and coordinate external requests, such as search and write requests. They play an important role in handling high-load queries, complex aggregations, managing a large number of shards, and improving cluster scalability.                                                                                                                                                                              |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                               |
      |                                   | After enabling the client node, specify **Node Specifications**, **Nodes** and **Node Storage Type**. The value of **Nodes** ranges from 1 to 32. The value of **Node Storage Capacity** is fixed. You can select a storage type based on your needs.                                                                                                                                                                         |
      +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Cold data node                    | Cold data nodes are used to store query latency-insensitive data in large quantities. They offer an effective way to manage large datasets and cut storage costs.                                                                                                                                                                                                                                                             |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                               |
      |                                   | After enabling cold data node, configure **Node Specifications**, **Nodes**, **Node Storage Type**, and **Node Storage Capacity**. The value of **Nodes** ranges from 1 to 32. Select **Node Storage Type** and **Node Storage Capacity** as required.                                                                                                                                                                        |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                               |
      |                                   | When cold data nodes are enabled, users can switch between cold and hot data nodes. For details, see :ref:`Switching Between Hot and Cold Storage for an Elasticsearch Cluster <css_01_0079>`.                                                                                                                                                                                                                                |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                               |
      |                                   | .. note::                                                                                                                                                                                                                                                                                                                                                                                                                     |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                               |
      |                                   |    If the number of cold data nodes in a cluster is not an integer multiple of that of AZs, data in the cluster may be unevenly distributed, affecting data query or write performance.                                                                                                                                                                                                                                       |
      +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Disk Encryption                   | Whether to encrypt the data disks of cluster nodes using Key Management Service (KMS).                                                                                                                                                                                                                                                                                                                                        |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                               |
      |                                   | Enabling disk encryption enhances the security of the data stored on cluster nodes. By default, disk encryption is disabled.                                                                                                                                                                                                                                                                                                  |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                               |
      |                                   | After disk encryption is enabled, you need to configure **Key Name** by selecting an enabled KMS key from the drop-down list. If no key is available, click **Create key** to go to the Data Encryption Workshop (DEW) console and create a new key or modify an existing key. For details, see `Creating a Key <https://docs.otc.t-systems.com/key-management-service/umn/user_guide/key_management/creating_a_key.html>`__. |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                               |
      |                                   | .. note::                                                                                                                                                                                                                                                                                                                                                                                                                     |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                               |
      |                                   |    -  Only cloud disks support disk encryption. Local disks do not support disk encryption.                                                                                                                                                                                                                                                                                                                                   |
      |                                   |    -  Only custom keys whose **Key Algorithm** is AES or SM4 and **Usage** is **ENCRYPT_DECRYPT** are supported. KMS keys that are unavailable in the **Key Name** drop-down list are not supported by the cluster.                                                                                                                                                                                                           |
      |                                   |    -  Disk encryption and decryption do not alter cluster management or O&M processes. However, they do increase the system's processing load, potentially affecting the system's operational performance.                                                                                                                                                                                                                    |
      |                                   |    -  Once a cluster is already created, disk encryption cannot be enabled or disabled.                                                                                                                                                                                                                                                                                                                                       |
      |                                   |    -  After cluster creation, the KMS key cannot be changed.                                                                                                                                                                                                                                                                                                                                                                  |
      |                                   |    -  If the KMS key used by the cluster is disabled, the cluster cannot be scaled or upgraded, its node specifications or AZs cannot be changed, and its nodes cannot be replaced (by specifying the nodes that need replacement). To solve this problem, you will have to create a new cluster and migrate your data to that new cluster.                                                                                   |
      +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Enterprise Project                | When creating a CSS cluster, you can bind an enterprise project to the cluster if you have enabled the enterprise project function.                                                                                                                                                                                                                                                                                           |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                               |
      |                                   | Select an enterprise project from the **Enterprise Project** drop-down list, or click **View Enterprise Project** to go to the **Enterprise Project Management Service** page and check existing enterprise projects.                                                                                                                                                                                                         |
      +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+


   .. figure:: /_static/images/en-us_image_0000001946083800.png
      :alt: **Figure 1** Setting cluster node specifications

      **Figure 1** Setting cluster node specifications

#. Click **Next: Network**.

#. On the **Network** page, configure the network settings and security mode for the Elasticsearch cluster.

   .. table:: **Table 3** Network settings for the Elasticsearch cluster

      +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Parameter                         | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
      +===================================+=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+
      | VPC                               | Specify a VPC to isolate the cluster's network.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
      |                                   | Click **View VPC** to go to the VPC management console and check the created VPCs.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
      |                                   | If no VPC is available, contact the CSS administrator to create a new VPC. For details, see section "Creating a VPC and Subnet" in *VPC User Guide*.                                                                                                                                                                                                                                                                                                                                                                                                                                                |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
      |                                   | .. note::                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
      |                                   |    The VPC must contain CIDRs. Otherwise, cluster creation will fail. By default, a created VPC contains CIDRs.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
      +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Subnet                            | A subnet provides dedicated network resources that are isolated from other networks, improving network security.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
      |                                   | Select a subnet needed by the cluster in the current VPC.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
      +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Security Group                    | A security group serves as a virtual firewall that provides access control policies for clusters.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
      |                                   | Select a security group for the cluster. Click **View Security Group** to go to the security group list, where you can view details about security groups.                                                                                                                                                                                                                                                                                                                                                                                                                                          |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
      |                                   | .. note::                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
      |                                   |    -  Ensure that **Port/Range** is set to **All** or a port range that includes port **9200** for the selected security group.                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
      |                                   |    -  If your cluster version is 7.6.2 or later, ensure that all the ports used for communication between nodes in the same security group are allowed. If such settings cannot be configured, ensure at least the access to port 9300 is allowed.                                                                                                                                                                                                                                                                                                                                                  |
      |                                   |    -  After the port 9300 is enabled, if the cluster disk usage is high, delete expired data to release the disk storage space.                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
      +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Security Mode                     | Whether to enable the security mode for the cluster.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
      |                                   | -  The security mode is enabled by default. In security mode, a cluster's communication is encrypted and access to the cluster requires user authentication. This is why the **Administrator Username** and **Administrator Password** of the cluster are needed.                                                                                                                                                                                                                                                                                                                                   |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
      |                                   |    -  The default administrator username is **admin**.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
      |                                   |    -  Set and confirm the **Administrator Password**. This password will be required when you access this cluster.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
      |                                   | -  If **Security Mode** is disabled, a cluster in non-security mode will be created. With such a cluster, access to the cluster will not require user authentication, and data will be transmitted in plaintext using HTTP. Make sure the customer is in a secure environment, and do not expose the cluster access interface to the public network.                                                                                                                                                                                                                                                |
      +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | HTTPS Access                      | HTTPS access can be enabled only when security mode is enabled for the cluster. With HTTPS access enabled, communication will be encrypted when you access the cluster.                                                                                                                                                                                                                                                                                                                                                                                                                             |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
      |                                   | .. note::                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
      |                                   |    A cluster in security mode uses HTTPS for communication, but its read performance will not be as good as a non-security mode cluster that uses HTTP. The performance loss is estimated at around 20% under high concurrency. If you want fast read performance as well as the isolation and permission control (such as indexes, documents, and fields) enabled by the security mode, you can disable **HTTPS Access**. After **HTTPS Access** is disabled, HTTP protocol is used for cluster communication. In this case, data security cannot be ensured and public IP address cannot be used. |
      +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Public IP Address                 | This parameter is available only when **Security Mode** and **HTTPS Access** are enabled. When **Public IP Address** is enabled, a public IP address is automatically assigned, which will enable access to the security cluster from the Internet. For details, see :ref:`Configuring Public Network Access for an Elasticsearch Cluster <css_01_0076>`.                                                                                                                                                                                                                                           |
      +-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+


   .. figure:: /_static/images/en-us_image_0000001973202625.png
      :alt: **Figure 2** Configuring the cluster network

      **Figure 2** Configuring the cluster network

#. Click **Next: Advanced Settings**.

#. .. _css_01_0380__en-us_topic_0000001268594549_li692975642819:

   On the **Advanced Settings** page, configure a snapshot policy and other advanced settings for the Elasticsearch cluster.

   a. Set a cluster snapshot policy.

      Cluster snapshots are enabled by default. You can disable them by toggling off **Cluster Snapshot**. To store snapshots automatically created in OBS, an agency will need to be created in order to access OBS. Fees will be incurred for using standard OBS storage.

      .. table:: **Table 4** Basic configuration for a cluster snapshot policy

         +-----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Parameter                         | Description                                                                                                                                                                                                                                                                                       |
         +===================================+===================================================================================================================================================================================================================================================================================================+
         | OBS Bucket                        | Select an OBS bucket for storing snapshots from the drop-down list box. You can also click **Create Bucket** on the right to create an OBS bucket. For details, see `Creating a Bucket <https://docs.otc.t-systems.com/en-us/usermanual/obs/en-us_topic_0045853662.html>`__.                      |
         |                                   |                                                                                                                                                                                                                                                                                                   |
         |                                   | The created or existing OBS bucket must meet the following requirements:                                                                                                                                                                                                                          |
         |                                   |                                                                                                                                                                                                                                                                                                   |
         |                                   | -  **Storage Class** is **Standard** or **Warm**.                                                                                                                                                                                                                                                 |
         |                                   | -  **Region** must be the same as that of the created cluster.                                                                                                                                                                                                                                    |
         +-----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Backup Path                       | Storage path of the snapshot in the OBS bucket.                                                                                                                                                                                                                                                   |
         |                                   |                                                                                                                                                                                                                                                                                                   |
         |                                   | The backup path cannot:                                                                                                                                                                                                                                                                           |
         |                                   |                                                                                                                                                                                                                                                                                                   |
         |                                   | -  Contain the following characters: ``\:*?"<>|'{}``                                                                                                                                                                                                                                              |
         |                                   | -  Start with a slash (/).                                                                                                                                                                                                                                                                        |
         |                                   | -  Start or end with a period (.).                                                                                                                                                                                                                                                                |
         |                                   | -  Contain more than two consecutive slashes (/) or periods (.).                                                                                                                                                                                                                                  |
         |                                   | -  Exceed 512 characters.                                                                                                                                                                                                                                                                         |
         +-----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | IAM Agency                        | IAM agency authorized by the current account for CSS to access or maintain data stored in OBS. If no agency is available, contact the CSS administrator to create one. For details, see `Creating an Agency <https://docs.otc.t-systems.com/en-us/usermanual/iam/en-us_topic_0046613147.html>`__. |
         |                                   |                                                                                                                                                                                                                                                                                                   |
         |                                   | The selected IAM agency must meet the following requirements:                                                                                                                                                                                                                                     |
         |                                   |                                                                                                                                                                                                                                                                                                   |
         |                                   | -  **Agency Type** must be **Cloud service**.                                                                                                                                                                                                                                                     |
         |                                   | -  Set **Cloud Service** to **CSS**.                                                                                                                                                                                                                                                              |
         |                                   | -  Mandatory policies: **Tenant Administrator** or **OBS Administrator**.                                                                                                                                                                                                                         |
         |                                   |                                                                                                                                                                                                                                                                                                   |
         |                                   | .. note::                                                                                                                                                                                                                                                                                         |
         |                                   |                                                                                                                                                                                                                                                                                                   |
         |                                   |    The agency name can contain only letters (case-sensitive), digits, underscores (_), and hyphens (-). Otherwise, the backup will fail.                                                                                                                                                          |
         +-----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

      .. table:: **Table 5** Setting Automatic Snapshot Creation

         +-------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Parameter               | Description                                                                                                                                                                                                                                                                             |
         +=========================+=========================================================================================================================================================================================================================================================================================+
         | Snapshot Name Prefix    | The snapshot name prefix contains 1 to 32 characters and must start with a lowercase letter. Only lowercase letters, digits, hyphens (-), and underscores (_) are allowed. A snapshot name consists of a snapshot name prefix and a timestamp, for example, **snapshot-1566921603720**. |
         +-------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Time Zone               | Time zone for the backup time. Specify **Backup Started Time** based on the time zone.                                                                                                                                                                                                  |
         +-------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Backup Start Time       | The time when the backup starts automatically every day. You can specify this parameter only in full hours, for example, 00:00 or 01:00. The value ranges from 00:00 to 23:00. Select a time from the drop-down list.                                                                   |
         +-------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Retention Period (days) | The number of days that snapshots are retained in the OBS bucket. The value ranges from 1 to 90, and the default value is 7. You can specify this parameter as required. The system automatically deletes expired snapshots every half hour.                                            |
         +-------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

   b. Configure advanced settings for the cluster. Select **Default** or **Custom**.

      -  **Default**: **VPC Endpoint Service**, **Kibana Public Access** are disabled by default. You can manually enable these settings after the cluster is created.
      -  **Custom**: You can enable **VPC Endpoint Service**, **Kibana Public Access** as required.

      **VPC Endpoint Service**

      VPC Endpoint Service enables you to access resources across Virtual Private Clouds (VPCs) using a dedicated gateway, without exposing the network information of servers. When VPC Endpoint Service is enabled, a VPC endpoint will be created by default. You can select Private Domain Name Creation if necessary. Users will be able to access this cluster across VPCs through node IP addresses or a private domain name.

      .. table:: **Table 6** Configuring VPC Endpoint Service

         +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Parameter                         | Description                                                                                                                                                                                                                                                                    |
         +===================================+================================================================================================================================================================================================================================================================================+
         | Private Domain Name Creation      | If **Private Domain Name Creation** is selected, the system generates a node IP address and also automatically creates a private domain name, which enables users to access this cluster from within the same VPC. If it is not selected, only a node IP address is generated. |
         +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Create professional endpoints     | Choose whether to create professional endpoints.                                                                                                                                                                                                                               |
         |                                   |                                                                                                                                                                                                                                                                                |
         |                                   | -  If unselected, a basic endpoint will be created.                                                                                                                                                                                                                            |
         |                                   | -  If selected, a professional endpoint will be created.                                                                                                                                                                                                                       |
         |                                   |                                                                                                                                                                                                                                                                                |
         |                                   | .. note::                                                                                                                                                                                                                                                                      |
         |                                   |                                                                                                                                                                                                                                                                                |
         |                                   |    If the region where the cluster is located does not support professional endpoints, this option is unavailable. By default, a basic endpoint is created.                                                                                                                    |
         +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | IPv4/IPv6 dual stack network      | Whether to enable IPv4/IPv6 dual-stack networking. This option is available only when IPv6 is enabled for the VPC subnet of the cluster and you have selected **Create professional endpoints** earlier.                                                                       |
         +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | VPC Endpoint Service Whitelist    | In **VPC Endpoint Service Whitelist**, you can add accounts that are allowed to access the cluster using a node IP address or private domain name.                                                                                                                             |
         |                                   |                                                                                                                                                                                                                                                                                |
         |                                   | -  Click **Add** to add accounts in **Authorized Account ID**. If the authorized account ID is set to **\***, all users are allowed to access the cluster.                                                                                                                     |
         |                                   | -  Click **Delete** in the **Operation** column to delete accounts.                                                                                                                                                                                                            |
         |                                   |                                                                                                                                                                                                                                                                                |
         |                                   | .. note::                                                                                                                                                                                                                                                                      |
         |                                   |                                                                                                                                                                                                                                                                                |
         |                                   |    To obtain your authorized account ID, point to your username in the upper right corner, and choose **My Credentials**. Copy the value of **Account ID**.                                                                                                                    |
         +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

      **Kibana Public Access**

      This parameter is available only when security mode is enabled for the cluster. By enabling this option, you can obtain a public IP address for accessing Kibana.

      .. table:: **Table 7** Configuring public network access for Kibana

         +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Parameter                         | Description                                                                                                                                                                                                                                                                                                                                                                                                       |
         +===================================+===================================================================================================================================================================================================================================================================================================================================================================================================================+
         | Bandwidth                         | Bandwidth for accessing Kibana through a public IP address                                                                                                                                                                                                                                                                                                                                                        |
         |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                   |
         |                                   | Value range: 1 to 100.                                                                                                                                                                                                                                                                                                                                                                                            |
         |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                   |
         |                                   | Unit: Mbit/s                                                                                                                                                                                                                                                                                                                                                                                                      |
         +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Access Control                    | If you disable this function, all IP addresses can access Kibana through the public IP address. If you enable this function, only IP addresses or IP address ranges in the whitelist can access Kibana through the public IP address.                                                                                                                                                                             |
         +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Whitelist                         | IP addresses or IP address ranges allowed to access the cluster. Use commas (,) to separate multiple IP addresses or ranges. This parameter can be configured only when **Access Control** is enabled.                                                                                                                                                                                                            |
         |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                   |
         |                                   | You are advised to enable the whitelist.                                                                                                                                                                                                                                                                                                                                                                          |
         |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                   |
         |                                   | .. note::                                                                                                                                                                                                                                                                                                                                                                                                         |
         |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                   |
         |                                   |    The whitelist that controls Kibana public network access depends on whitelist support by the ELB service. After you update the whitelist, the new settings take effect immediately for new connections. For existing persistent connections using the IP addresses that have been removed from the whitelist, the new settings take effect in approximately 1 minute after these connections are disconnected. |
         +-----------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

#. Click **Next: Confirm Configuration**. Check the configuration and click **Next** to create a cluster.

#. Click **Back to Cluster List** to switch to the **Clusters** page. The cluster you created is now in the cluster list and its status is **Creating**. If the cluster is successfully created, its status changes to **Available**.

   If cluster creation fails, try creating the cluster again by rectifying the errors returned.
