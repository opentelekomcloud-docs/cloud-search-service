:original_name: UpgradeDetail.html

.. _UpgradeDetail:

Obtaining Details About a Cluster Upgrade or AZ Switchover
==========================================================

Function
--------

The upgrade may take a long time. This API can be used to check phase-by-phase information during a cluster upgrade or AZ switchover.

URI
---

GET /v1.0/{project_id}/clusters/{cluster_id}/upgrade/detail

.. table:: **Table 1** Path Parameters

   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter       | Mandatory       | Type            | Description                                                                                                                          |
   +=================+=================+=================+======================================================================================================================================+
   | project_id      | Yes             | String          | **Parameter description**:                                                                                                           |
   |                 |                 |                 |                                                                                                                                      |
   |                 |                 |                 | The project ID. For details about how to obtain the project ID and name, see :ref:`Obtaining the Project ID and Name <css_03_0071>`. |
   |                 |                 |                 |                                                                                                                                      |
   |                 |                 |                 | **Constraints**:                                                                                                                     |
   |                 |                 |                 |                                                                                                                                      |
   |                 |                 |                 | N/A                                                                                                                                  |
   |                 |                 |                 |                                                                                                                                      |
   |                 |                 |                 | **Options**:                                                                                                                         |
   |                 |                 |                 |                                                                                                                                      |
   |                 |                 |                 | For details about how to obtain the project ID and name, see :ref:`Obtaining the Project ID and Name <css_03_0071>`.                 |
   |                 |                 |                 |                                                                                                                                      |
   |                 |                 |                 | **Default value**:                                                                                                                   |
   |                 |                 |                 |                                                                                                                                      |
   |                 |                 |                 | N/A                                                                                                                                  |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------+
   | cluster_id      | Yes             | String          | **Parameter description**:                                                                                                           |
   |                 |                 |                 |                                                                                                                                      |
   |                 |                 |                 | ID of the cluster to be upgraded.                                                                                                    |
   |                 |                 |                 |                                                                                                                                      |
   |                 |                 |                 | **Constraints**:                                                                                                                     |
   |                 |                 |                 |                                                                                                                                      |
   |                 |                 |                 | N/A                                                                                                                                  |
   |                 |                 |                 |                                                                                                                                      |
   |                 |                 |                 | **Options**:                                                                                                                         |
   |                 |                 |                 |                                                                                                                                      |
   |                 |                 |                 | For details about how to obtain the cluster ID, see :ref:`Obtaining the Cluster ID <css_03_0101>`.                                   |
   |                 |                 |                 |                                                                                                                                      |
   |                 |                 |                 | **Default value**:                                                                                                                   |
   |                 |                 |                 |                                                                                                                                      |
   |                 |                 |                 | N/A                                                                                                                                  |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------+

.. table:: **Table 2** Query Parameters

   +-----------------+-----------------+-----------------+-------------------------------------------------------------------------------------------------------------+
   | Parameter       | Mandatory       | Type            | Description                                                                                                 |
   +=================+=================+=================+=============================================================================================================+
   | start           | No              | Integer         | **Parameter description**:                                                                                  |
   |                 |                 |                 |                                                                                                             |
   |                 |                 |                 | The start value of the query. The default value is 1, indicating that the query starts from the first task. |
   |                 |                 |                 |                                                                                                             |
   |                 |                 |                 | **Constraints**:                                                                                            |
   |                 |                 |                 |                                                                                                             |
   |                 |                 |                 | N/A                                                                                                         |
   |                 |                 |                 |                                                                                                             |
   |                 |                 |                 | **Options**:                                                                                                |
   |                 |                 |                 |                                                                                                             |
   |                 |                 |                 | 1-1000                                                                                                      |
   |                 |                 |                 |                                                                                                             |
   |                 |                 |                 | **Default value**:                                                                                          |
   |                 |                 |                 |                                                                                                             |
   |                 |                 |                 | 1                                                                                                           |
   +-----------------+-----------------+-----------------+-------------------------------------------------------------------------------------------------------------+
   | limit           | No              | Integer         | **Parameter description**:                                                                                  |
   |                 |                 |                 |                                                                                                             |
   |                 |                 |                 | Number of tasks to be queried. The default value is **10**, indicating that 10 tasks are queried at a time. |
   |                 |                 |                 |                                                                                                             |
   |                 |                 |                 | **Constraints**:                                                                                            |
   |                 |                 |                 |                                                                                                             |
   |                 |                 |                 | N/A                                                                                                         |
   |                 |                 |                 |                                                                                                             |
   |                 |                 |                 | **Options**:                                                                                                |
   |                 |                 |                 |                                                                                                             |
   |                 |                 |                 | 1-1000                                                                                                      |
   |                 |                 |                 |                                                                                                             |
   |                 |                 |                 | **Default value**:                                                                                          |
   |                 |                 |                 |                                                                                                             |
   |                 |                 |                 | 10                                                                                                          |
   +-----------------+-----------------+-----------------+-------------------------------------------------------------------------------------------------------------+
   | action_mode     | No              | String          | **Parameter description**:                                                                                  |
   |                 |                 |                 |                                                                                                             |
   |                 |                 |                 | Query details about a cluster upgrade or AZ switchover.                                                     |
   |                 |                 |                 |                                                                                                             |
   |                 |                 |                 | **Constraints**:                                                                                            |
   |                 |                 |                 |                                                                                                             |
   |                 |                 |                 | N/A                                                                                                         |
   |                 |                 |                 |                                                                                                             |
   |                 |                 |                 | **Options**:                                                                                                |
   |                 |                 |                 |                                                                                                             |
   |                 |                 |                 | -  **UPGRADING**: query cluster upgrade details.                                                            |
   |                 |                 |                 |                                                                                                             |
   |                 |                 |                 | -  **AZ_MIGRATION**: query AZ switchover details.                                                           |
   |                 |                 |                 |                                                                                                             |
   |                 |                 |                 |    **Default value**:                                                                                       |
   |                 |                 |                 |                                                                                                             |
   |                 |                 |                 |    UPGRADING                                                                                                |
   +-----------------+-----------------+-----------------+-------------------------------------------------------------------------------------------------------------+

Request Parameters
------------------

None

Response Parameters
-------------------

**Status code: 200**

.. table:: **Table 3** Response body parameters

   +-----------------------+---------------------------------------------------------------------------------------------+--------------------------------------------------+
   | Parameter             | Type                                                                                        | Description                                      |
   +=======================+=============================================================================================+==================================================+
   | totalSize             | Integer                                                                                     | **Parameter description**:                       |
   |                       |                                                                                             |                                                  |
   |                       |                                                                                             | Total number of tasks.                           |
   +-----------------------+---------------------------------------------------------------------------------------------+--------------------------------------------------+
   | detailList            | Array of :ref:`GetUpgradeDetailInfo <upgradedetail__response_getupgradedetailinfo>` objects | **Parameter description**:                       |
   |                       |                                                                                             |                                                  |
   |                       |                                                                                             | Details about the upgrade or AZ switchover task. |
   +-----------------------+---------------------------------------------------------------------------------------------+--------------------------------------------------+

.. _upgradedetail__response_getupgradedetailinfo:

.. table:: **Table 4** GetUpgradeDetailInfo

   +-----------------------+---------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter             | Type                                                                                  | Description                                                                                                                                     |
   +=======================+=======================================================================================+=================================================================================================================================================+
   | id                    | String                                                                                | **Parameter description**:                                                                                                                      |
   |                       |                                                                                       |                                                                                                                                                 |
   |                       |                                                                                       | Task ID                                                                                                                                         |
   +-----------------------+---------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------+
   | startTime             | String                                                                                | **Parameter description**:                                                                                                                      |
   |                       |                                                                                       |                                                                                                                                                 |
   |                       |                                                                                       | Task start time.                                                                                                                                |
   +-----------------------+---------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------+
   | endTime               | String                                                                                | **Parameter description**:                                                                                                                      |
   |                       |                                                                                       |                                                                                                                                                 |
   |                       |                                                                                       | End time of a job.                                                                                                                              |
   +-----------------------+---------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------+
   | status                | String                                                                                | **Parameter description**:                                                                                                                      |
   |                       |                                                                                       |                                                                                                                                                 |
   |                       |                                                                                       | Task status.                                                                                                                                    |
   |                       |                                                                                       |                                                                                                                                                 |
   |                       |                                                                                       | **Options**:                                                                                                                                    |
   |                       |                                                                                       |                                                                                                                                                 |
   |                       |                                                                                       | -  **RUNNING**: The task is being executed.                                                                                                     |
   |                       |                                                                                       |                                                                                                                                                 |
   |                       |                                                                                       | -  **SUCCESS**: The task is successful.                                                                                                         |
   |                       |                                                                                       |                                                                                                                                                 |
   |                       |                                                                                       | -  **FAILED**: The job failed.                                                                                                                  |
   |                       |                                                                                       |                                                                                                                                                 |
   |                       |                                                                                       | -  **PARTIAL_FAILED**: The task failed partially.                                                                                               |
   +-----------------------+---------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------+
   | agencyName            | String                                                                                | **Parameter description**:                                                                                                                      |
   |                       |                                                                                       |                                                                                                                                                 |
   |                       |                                                                                       | Agency name. You can create an agency to allow CSS to call other cloud services.                                                                |
   +-----------------------+---------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------+
   | imageInfo             | :ref:`GetTargetImageIdDetail <upgradedetail__response_gettargetimageiddetail>` object | **Parameter description**:                                                                                                                      |
   |                       |                                                                                       |                                                                                                                                                 |
   |                       |                                                                                       | Image details.                                                                                                                                  |
   +-----------------------+---------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------+
   | totalNodes            | String                                                                                | **Parameter description**:                                                                                                                      |
   |                       |                                                                                       |                                                                                                                                                 |
   |                       |                                                                                       | Names of all nodes that need to be upgraded or switched to another AZ.                                                                          |
   +-----------------------+---------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------+
   | completedNodes        | String                                                                                | **Parameter description**:                                                                                                                      |
   |                       |                                                                                       |                                                                                                                                                 |
   |                       |                                                                                       | Names of all nodes that have been upgraded or switched to another AZ.                                                                           |
   +-----------------------+---------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------+
   | currentNodeName       | String                                                                                | **Parameter description**:                                                                                                                      |
   |                       |                                                                                       |                                                                                                                                                 |
   |                       |                                                                                       | Name of the node that is being upgraded or switched to another AZ.                                                                              |
   +-----------------------+---------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------+
   | executeTimes          | String                                                                                | **Parameter description**:                                                                                                                      |
   |                       |                                                                                       |                                                                                                                                                 |
   |                       |                                                                                       | Retry times.                                                                                                                                    |
   +-----------------------+---------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------+
   | migrateParam          | String                                                                                | **Parameter description**:                                                                                                                      |
   |                       |                                                                                       |                                                                                                                                                 |
   |                       |                                                                                       | This parameter is available only when **action_mode** is set to **AZ_MIGRATION**. It indicates the request parameter of the AZ switchover task. |
   +-----------------------+---------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------+
   | finalAzInfoMap        | String                                                                                | **Parameter description**:                                                                                                                      |
   |                       |                                                                                       |                                                                                                                                                 |
   |                       |                                                                                       | This parameter is available only when **action_mode** is set to **AZ_MIGRATION**. It indicates the AZ details of each node after AZ switchover. |
   +-----------------------+---------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------+
   | currentNodeDetail     | Array of :ref:`CurrentNodeDetail <upgradedetail__response_currentnodedetail>` objects | **Parameter description**:                                                                                                                      |
   |                       |                                                                                       |                                                                                                                                                 |
   |                       |                                                                                       | Task details of the node that is being upgraded or switched to another AZ.                                                                      |
   +-----------------------+---------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------+
   | batchSize             | Integer                                                                               | **Parameter description**:                                                                                                                      |
   |                       |                                                                                       |                                                                                                                                                 |
   |                       |                                                                                       | Number of nodes where data is being migrated concurrently.                                                                                      |
   +-----------------------+---------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------+
   | currentBatchNodes     | String                                                                                | **Parameter description**:                                                                                                                      |
   |                       |                                                                                       |                                                                                                                                                 |
   |                       |                                                                                       | Nodes where data is being migrated.                                                                                                             |
   +-----------------------+---------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------+

.. _upgradedetail__response_gettargetimageiddetail:

.. table:: **Table 5** GetTargetImageIdDetail

   +-----------------------+-----------------------+---------------------------------------------------------------------------+
   | Parameter             | Type                  | Description                                                               |
   +=======================+=======================+===========================================================================+
   | id                    | String                | **Parameter description**:                                                |
   |                       |                       |                                                                           |
   |                       |                       | ID of an image that can be upgraded.                                      |
   +-----------------------+-----------------------+---------------------------------------------------------------------------+
   | displayName           | String                | **Parameter description**:                                                |
   |                       |                       |                                                                           |
   |                       |                       | Name of an image that can be upgraded.                                    |
   +-----------------------+-----------------------+---------------------------------------------------------------------------+
   | imageDesc             | String                | **Parameter description**:                                                |
   |                       |                       |                                                                           |
   |                       |                       | Image description.                                                        |
   +-----------------------+-----------------------+---------------------------------------------------------------------------+
   | datastoreType         | String                | **Parameter description**:                                                |
   |                       |                       |                                                                           |
   |                       |                       | Image engine type.                                                        |
   +-----------------------+-----------------------+---------------------------------------------------------------------------+
   | datastoreVersion      | String                | **Parameter description**:                                                |
   |                       |                       |                                                                           |
   |                       |                       | Image engine version.                                                     |
   +-----------------------+-----------------------+---------------------------------------------------------------------------+
   | priority              | Integer               | **Parameter description**:                                                |
   |                       |                       |                                                                           |
   |                       |                       | Priority of the target image. A larger value indicates a higher priority. |
   +-----------------------+-----------------------+---------------------------------------------------------------------------+

.. _upgradedetail__response_currentnodedetail:

.. table:: **Table 6** CurrentNodeDetail

   +-----------------------+-----------------------+----------------------------------------------------+
   | Parameter             | Type                  | Description                                        |
   +=======================+=======================+====================================================+
   | order                 | Integer               | **Parameter description**:                         |
   |                       |                       |                                                    |
   |                       |                       | SN of the upgrade or AZ switchover task.           |
   +-----------------------+-----------------------+----------------------------------------------------+
   | name                  | String                | **Parameter description**:                         |
   |                       |                       |                                                    |
   |                       |                       | Name of the upgrade or AZ switchover task.         |
   +-----------------------+-----------------------+----------------------------------------------------+
   | status                | String                | **Parameter description**:                         |
   |                       |                       |                                                    |
   |                       |                       | Current task status.                               |
   |                       |                       |                                                    |
   |                       |                       | **Options**:                                       |
   |                       |                       |                                                    |
   |                       |                       | -  **RUNNING**: The task is running.               |
   |                       |                       |                                                    |
   |                       |                       | -  **SUCCESS**: The task has succeeded.            |
   |                       |                       |                                                    |
   |                       |                       | -  **FAILED**: The task failed.                    |
   |                       |                       |                                                    |
   |                       |                       | -  **WAITING**: The task is waiting for execution. |
   +-----------------------+-----------------------+----------------------------------------------------+
   | desc                  | String                | **Parameter description**:                         |
   |                       |                       |                                                    |
   |                       |                       | Description of the current task.                   |
   +-----------------------+-----------------------+----------------------------------------------------+
   | beginTime             | String                | **Parameter description**:                         |
   |                       |                       |                                                    |
   |                       |                       | Start time of the current task.                    |
   +-----------------------+-----------------------+----------------------------------------------------+
   | endTime               | String                | **Parameter description**:                         |
   |                       |                       |                                                    |
   |                       |                       | End time of the current task.                      |
   +-----------------------+-----------------------+----------------------------------------------------+

Example Requests
----------------

-  Query cluster upgrade details.

   .. code-block:: text

      GET https://{Endpoint}/v1.0/6204a5bd270343b5885144cf9c8c158d/clusters/ea244205-d641-45d9-9dcb-ab2236bcd07e/upgrade/detail

-  Example of an AZ switchover.

   .. code-block:: text

      GET /v1.0/6204a5bd270343b5885144cf9c8c158d/clusters/ea244205-d641-45d9-9dcb-ab2236bcd07e/upgrade/detail?action_mode=AZ_MIGRATION

Example Responses
-----------------

**Status code: 200**

Request succeeded.

-  Example of a cluster image upgrade response.

   .. code-block::

      {
        "totalSize" : 1,
        "detailList" : [ {
          "id" : "b7ac4c5b-3bda-4feb-a303-eb80f4bce986",
          "startTime" : "2023-01-05T02:23:39",
          "endTime" : "",
          "status" : "RUNNING",
          "agencyName" : "css_test_agency",
          "imageInfo" : {
            "id" : "439b5d30-5968-45df-b088-d030a858522d",
            "displayName" : "7.10.2_22.5.1_1230",
            "imageDesc" : "The latest image of version 7.10.2 will be officially released on December 30, 2022. the stability of the cluster has been optimized. It is recommended that you upgrade to this version.",
            "datastoreType" : "elasticsearch",
            "datastoreVersion" : "7.10.2",
            "priority" : 16
          },
          "totalNodes" : "css-test-ess-esn-1-1,css-test-ess-esn-2-1,css-test-ess-esn-3-1",
          "completedNodes" : "",
          "currentNodeName" : "css-test-ess-esn-1-1",
          "executeTimes" : "1",
          "currentNodeDetail" : [ {
            "order" : 0,
            "name" : "Data migration",
            "status" : "SUCCESS",
            "desc" : "Data is migrated from a node to other nodes in the cluster by running the exclude command.",
            "beginTime" : "2023-01-05T02:23:42",
            "endTime" : "2023-01-05T02:29:51"
          }, {
            "order" : 12,
            "name" : "Task status update",
            "status" : "WAITING",
            "desc" : "The cluster task status is refreshed. If there are no nodes to be replaced, the task is marked as completed. Otherwise, another node starts to be replaced.",
            "beginTime" : "",
            "endTime" : ""
          } ]
        } ]
      }

-  Example of an AZ switchover response.

   .. code-block::

      {
        "totalSize" : 1,
        "detailList" : [ {
          "id" : "8ebe958b-b8c6-4939-b5a7-85aee9468888",
          "startTime" : "2022-12-29T08:32:29",
          "endTime" : "",
          "status" : "RUNNING",
          "agencyName" : "css_test_agency",
          "totalNodes" : "css-test-ess-esn-2-1,css-test-ess-esn-1-1,css-test-ess-esn-3-1",
          "completedNodes" : "css-test-ess-esn-2-1",
          "currentNodeName" : "css-test-ess-esn-1-1",
          "executeTimes" : "1",
          "migrateParam" : "{\"instType\":\"ess\",\"migrateType\":\"az_migrate\",\"sourceAz\":\"cn-north-4a\",\"targetAz\":\"cn-north-4c\"}",
          "finalAzInfoMap" : "{\"cn-north-4c\":\"css-test-ess-esn-2-1,css-test-ess-esn-1-1,css-test-ess-esn-3-1\"}",
          "currentNodeDetail" : [ {
            "order" : 0,
            "name" : "Data migration",
            "status" : "SUCCESS",
            "desc" : "Data is migrated from a node to other nodes in the cluster by running the exclude command.",
            "beginTime" : "2022-12-29T08:41:05",
            "endTime" : "2022-12-29T08:41:23"
          }, {
            "order" : 12,
            "name" : "Task status update",
            "status" : "RUNNING",
            "desc" : "The cluster task status is refreshed. If there are no nodes to be replaced, the task is marked as completed. Otherwise, another node starts to be replaced.",
            "beginTime" : "2023-01-04T06:53:42",
            "endTime" : ""
          } ]
        } ]
      }

Status Codes
------------

+-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Status Code                       | Description                                                                                                                                                     |
+===================================+=================================================================================================================================================================+
| 200                               | Request succeeded.                                                                                                                                              |
+-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 400                               | Invalid request.                                                                                                                                                |
|                                   |                                                                                                                                                                 |
|                                   | The client should not repeat the request without modifications.                                                                                                 |
+-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 403                               | Request rejected.                                                                                                                                               |
|                                   |                                                                                                                                                                 |
|                                   | The server has received the request and understood it, but the server refuses to respond to it. The client should not repeat the request without modifications. |
+-----------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------+

Error Codes
-----------

See :ref:`Error Codes <css_03_0076>`.
